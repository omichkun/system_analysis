# Описание

## Общее описание схемы

Все схемы лежат в документе 2hw.drawio. Открывать его с помощью https://app.diagrams.net/ или, для локального скачивания – https://github.com/jgraph/drawio-desktop/releases/tag/v21.2.8 


Схема содержит в себе несколько вкладок: 

- Subdomains - определение субдоменов бизнеса
- Core domain chart – распределение типов доменов по важности для бизнеса
- Bounded contexts with subdomains – определение кограниченных контекстов и соотнесение их с бизнес-доменами
- Event Storming – обновленный ES с новыми контекстами
- Contexts with Relations – модель данных
- Contexts and Services – модель разбиения контекстов по сервисам
- Implementation – реализация

## Subdomains

Выделил следующие предположительные бизнес-домены:

1. Матчинг – отдельная команда программистов + менеджер, которые занимаются только алгоритмом матчинга воркеров.
1. Тестирование и найм – отсев и найм новых воркеров.
1. Менеджмент заказов – домен бизнеса, в котором происходит в целом осуществление контроля за тем, что заказы переходят по статусам, добавление новых услуг и прочее. Некая административная часть.
1. Сбор расходников – склад и заказ расходников, заказ печенек.
1. Расчет и выплаты – бухгалтерия. Там вечно все путают и воркеру Лупе выдают деньги за Пупу...
1. Контроль качества – отдельная команда по контролю качества заказов.


## Core domain chart

Расписал в таблице бизнес-домены, выписал их предположительную сложность и важность для бизнеса (а также то, насколько этот домен дифференцирует бизнес) и расположил их на core domain chart.

1. Матчинг и подбор кандидатов точно являются core domain'ами, так как в тексте задания это явно указано: "Благодаря отсеву и матчингу компания планирует выделяться на фоне конкурентов."
1. Склад и сбор расходников, а также домен менеджмента заказов – выделил их как generic domain. Управление складом в целом несложная система (по крайней мере, в контексте MCF) и если мы заменим это решение на какое-нибудь другое, бизнес останется собой. Менеджмент заказов – довольно специфическая система для нашей системы, готовое решение вряд ли есть, поэтому решил, что можно заказать команду на аутсорсе.
1. Контроль качества и расчеты выплат – вынесены в supporting domain. Они важны для бизнеса и предполагается, что достаточно сложные (правила расчета скидок – там, в теории, могут быть относительно частые изменения), контроль качества 


## Bounded contexts with subdomains

Здесь есть расхождения в контекстах, по сравнению с первой домашкой в следующем: 

1. В первой домашке я выделил отправку нотификаций в отдельный контекст, в новой версии я его убрал, так как это детали технической реализации.
1. В первой домашке у меня было разделение на клиентский контекст, в котором по факту происходило только создание заказа, и контекст воркера, в котором, по сути, было принятие заказа, нажатие кнопки "Заказ начат", "Заказ выполнен" и отправка фотографий актов выполнения работ. А также в первой был еще конекст администрирования, в котором менеджер создавал новые типы заказов и управлял клиентами и воркерами. Здесь я объединил эти контексты в один – Создание и управление заказом. Потому что в клиентский контекст и контекст воркера по сути выполняют одну задачу –  управление заказом (перевод его по статусам) и редактирование услуг. Все эти контексты друг без друга не имеют смысла.
1. Также здесь я определил контекст "вовлечение менеджеров" (функциональность ставок на заказы). Определил его в домен управления заказами, так как отдельного домена для этого контекста в рамках бизнеса не существует (нет отдела, который занимается ставками, менеджит их, отслеживает и т. д.). Ближайший к этому домен – управление заявками.
1. В итоге из 11 контекстов в первой домашке здесь осталось всего 7


## Event Storming

Здесь в контексте "Система расчета и начисления ЗП, списания средств с клиента" вынужденно оставил технические шаги вместо бизнес-событий, так как не придумал новых нормальных названий для этих событий (в месте где есть события на добавление транзакций). 


## Contexts with Relations

Актуализировал также и схему сервисов с предполагаемыми потоками данных. По структуре самих данных особых изменений нет. Есть только измненеия между связями, так как количество контекство увеличилось. Какие-то данные схлопнулись в один контекст.


## Contexts and Services

Актуализировал предполагаемую схему сервисов и обмена данных между ними.


# Характеристики

## В целом для системы: 

- **agility**, **testability** и **deployability** – "Бизнесу необходим низкий ТТМ (Time To Market), чтобы конкурировать на рынке". То есть бизнесу нужно быстро деплоиться, быстро тестить гипотезы и быстро подстраиваться под окружающий мир. 
- **scalability** – "MCF планирует использовать ... самый совершенный матчинг между котами-клиентами **(пока только тестировщиками happy cat box, но компания планирует расширяться в будущем)** и воркерами."


## Для контекста тестирования и матчинга: 

- **modifiability** и **agility** – "Благодаря отсеву и матчингу компания планирует выделяться на фоне конкурентов." – это говорит о том, что в этих областях будет высокая изменяемость кода, т. к. часто и много будет проверяться разных гипотез.

## Для контекста тестирования: 

- **elasticity** – "судя по отзывам, наши конкуренты могут попытаться нас заддосить в этом месте" 
- **scalability** – "MCF планирует использовать самые передовые алгоритмы отсева воркеров и самый совершенный матчинг между котами-клиентами (пока только тестировщиками happy cat box, но **компания планирует расширяться в будущем**) и воркерами". Также в этом месте весьма вероятно значительное увеличение числа пользователей (менеджеров), либо передача части задач на аутстафф, так как "Ставки могут делать только **менеджеры, которых будет не больше 15 человек**" и "Мы ожидаем **1 к заявок в день** от рандомных котов". 15 человек на проверку и обзвон 1к кандидатов как-то маловато. 


## Архитектура
Из предложенных четырех архитектурных стилей я бы выбрал смешанный – монолит + микросервисы (вкладка **Contexts and Services**).
Монолит для контекстов, в которых не предвидится какой-либо большой нагрузки и изменчивости кода. А тестирование и матчинг вынести в отдельные сервисы. 

Тестирование – потому что есть предположение, что это будет довольно нагруженная часть системы + туда возможны пиковые нагрузки в виде ДДОС от конкурентов. Это не должно аффектить остальную систему.
Матчинг – потому что там предполагается высокая изменяемость, частая выкатка (полне вероятно, что независимая от других сервисов) и проверка разных гипотез.